""" Code is generated by ucloud-model, DO NOT EDIT IT. """

import pytest
import logging

from ucloud.core import exc
from ucloud.testing import env, funcs, op, utest

logger = logging.getLogger(__name__)


scenario = utest.Scenario(255)


@pytest.mark.skipif(env.is_ut(), reason=env.get_skip_reason())
def test_set_289(client: utest.Client, variables: dict):
    scenario.initial(variables)

    scenario.variables["HostName"] = "auto_host_test3"
    scenario.variables["Password"] = "Z3VhbmxpeXVhbm1pbWExMjM="
    scenario.variables["ChargeType"] = "Month"
    scenario.variables["CreateCPU"] = 1
    scenario.variables["CreateMem"] = 1024
    scenario.variables["ImageId"] = "#{u_get_image_resource($Region,$Zone)}"
    scenario.variables["BootSize"] = 20
    scenario.variables["BootType"] = "CLOUD_SSD"
    scenario.variables["DiskSize"] = 20
    scenario.variables["DiskType"] = "CLOUD_NORMAL"
    scenario.variables["BootBackup"] = "NONE"
    scenario.variables["DiskBackup"] = "NONE"
    scenario.variables["UHostType"] = "N2"
    scenario.variables["UDiskType"] = "DataDisk"
    scenario.variables["Size"] = 1
    scenario.variables["UDataArkMode"] = "No"
    scenario.variables["UDiskName"] = "auto_udisk_noArk"

    scenario.run(client)


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="DescribeUDiskPrice",
)
def describe_udisk_price_00(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDataArkMode": variables.get("UDataArkMode"),
        "Size": variables.get("Size"),
        "Region": variables.get("Region"),
        "Quantity": 1,
        "DiskType": variables.get("UDiskType"),
        "ChargeType": "Month",
    }

    try:
        resp = client.udisk().describe_udisk_price(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=True,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "CheckUDiskAllowanceResponse"),
    ],
    action="CheckUDiskAllowance",
)
def check_udisk_allowance_01(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "Size": variables.get("Size"),
        "Region": variables.get("Region"),
        "Count": 1,
    }

    try:
        resp = client.invoke("CheckUDiskAllowance", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=2,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "CreateUDiskResponse"),
    ],
    action="CreateUDisk",
)
def create_udisk_02(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDataArkMode": variables.get("UDataArkMode"),
        "Size": variables.get("Size"),
        "Region": variables.get("Region"),
        "Quantity": 0,
        "Name": variables.get("UDiskName"),
        "DiskType": variables.get("UDiskType"),
        "ChargeType": "Month",
    }

    try:
        resp = client.udisk().create_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["udisk_noArk_Id"] = utest.value_at_path(resp, "UDiskId.0")
    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=10,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "DataSet.0.Status", "Available"),
    ],
    action="DescribeUDisk",
)
def describe_udisk_03(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().describe_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "CreateUDiskSnapshotResponse"),
    ],
    action="CreateUDiskSnapshot",
)
def create_udisk_snapshot_04(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
        "Name": "snapshot_01",
        "Comment": "comment_01",
    }

    try:
        resp = client.udisk().create_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["snapshot1_Id"] = utest.value_at_path(resp, "SnapshotId.0")
    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=120,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "DataSet.0.SnapshotLimit", 3),
        ("str_eq", "DataSet.0.SnapshotCount", 1),
        ("str_eq", "DataSet.0.Status", "Available"),
    ],
    action="DescribeUDisk",
)
def describe_udisk_05(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().describe_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=50,
    retry_interval=3,
    startup_delay=120,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "UHostSnapshotSet.0.DiskId", "udisk_noArk_Id"),
        ("str_eq", "UHostSnapshotSet.0.State", "Normal"),
    ],
    action="DescribeSnapshot",
)
def describe_snapshot_06(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotIds": [variables.get("snapshot1_Id")],
        "Region": variables.get("Region"),
    }

    try:
        resp = client.invoke("DescribeSnapshot", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="CreateUDiskSnapshot",
)
def create_udisk_snapshot_07(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
        "Name": "snapshot_02",
        "Comment": "comment_01",
    }

    try:
        resp = client.udisk().create_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["snapshot2_Id"] = utest.value_at_path(resp, "SnapshotId.0")
    return resp


@scenario.step(
    max_retries=30,
    retry_interval=5,
    startup_delay=120,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "UHostSnapshotSet.0.DiskId", "udisk_noArk_Id"),
        ("str_eq", "UHostSnapshotSet.0.State", "Normal"),
    ],
    action="DescribeSnapshot",
)
def describe_snapshot_08(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotIds": [variables.get("snapshot2_Id")],
        "Region": variables.get("Region"),
    }

    try:
        resp = client.invoke("DescribeSnapshot", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "CreateUDiskSnapshotResponse"),
    ],
    action="CreateUDiskSnapshot",
)
def create_udisk_snapshot_09(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
        "Name": "snapshot_03",
        "Comment": "comment_03",
    }

    try:
        resp = client.udisk().create_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["snapshot3_Id"] = utest.value_at_path(resp, "SnapshotId.0")
    return resp


@scenario.step(
    max_retries=30,
    retry_interval=5,
    startup_delay=120,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "DescribeUDiskSnapshotResponse"),
        ("str_eq", "DataSet.0.Status", "Normal"),
        ("str_eq", "DataSet.0.UDiskId", "udisk_noArk_Id"),
    ],
    action="DescribeUDiskSnapshot",
)
def describe_udisk_snapshot_10(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotId": variables.get("snapshot3_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().describe_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=10,
    fast_fail=False,
    validators=lambda variables: [("gt", "RetCode", 16999)],
    action="CreateUDiskSnapshot",
)
def create_udisk_snapshot_11(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
        "Name": "snapshot_04",
        "Comment": "comment_04",
    }

    try:
        resp = client.udisk().create_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=2,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "CloneUDiskSnapshotResponse"),
    ],
    action="CloneUDiskSnapshot",
)
def clone_udisk_snapshot_12(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDataArkMode": "Yes",
        "SourceId": variables.get("snapshot1_Id"),
        "Size": variables.get("Size"),
        "Region": variables.get("Region"),
        "Quantity": 0,
        "Name": "clone_snap1_Ark",
        "ChargeType": "Month",
    }

    try:
        resp = client.udisk().clone_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["clone_snap1_Ark"] = utest.value_at_path(resp, "UDiskId.0")
    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=10,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "CloneUDiskSnapshotResponse"),
    ],
    action="CloneUDiskSnapshot",
)
def clone_udisk_snapshot_13(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDataArkMode": "No",
        "SourceId": variables.get("snapshot1_Id"),
        "Size": variables.get("Size"),
        "Region": variables.get("Region"),
        "Quantity": 0,
        "Name": "clone_snap1_noArk",
        "ChargeType": "Month",
    }

    try:
        resp = client.udisk().clone_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["clone_snap1_noArk"] = utest.value_at_path(resp, "UDiskId.0")
    return resp


@scenario.step(
    max_retries=10,
    retry_interval=1,
    startup_delay=30,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "RestoreUDiskResponse"),
    ],
    action="RestoreUDisk",
)
def restore_udisk_14(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "SnapshotId": variables.get("snapshot1_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().restore_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=30,
    retry_interval=3,
    startup_delay=50,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "DataSet.0.Status", "Available"),
    ],
    action="DescribeUDisk",
)
def describe_udisk_15(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().describe_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "SnapshotId", variables.get("snapshot1_Id")),
    ],
    action="DeleteSnapshot",
)
def delete_snapshot_16(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotId": variables.get("snapshot1_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.invoke("DeleteSnapshot", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=1,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "TotalCount", 0),
        ("str_eq", "PerDiskQuota", 3),
    ],
    action="DescribeSnapshot",
)
def describe_snapshot_17(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotIds": [variables.get("snapshot1_Id")],
        "Region": variables.get("Region"),
    }

    try:
        resp = client.invoke("DescribeSnapshot", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "SnapshotId", variables.get("snapshot2_Id")),
    ],
    action="DeleteSnapshot",
)
def delete_snapshot_18(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotId": variables.get("snapshot2_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.invoke("DeleteSnapshot", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=5,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "TotalCount", 0),
        ("str_eq", "PerDiskQuota", 3),
    ],
    action="DescribeSnapshot",
)
def describe_snapshot_19(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotIds": [variables.get("snapshot2_Id")],
        "Region": variables.get("Region"),
    }

    try:
        resp = client.invoke("DescribeSnapshot", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "DeleteUDiskSnapshotResponse"),
    ],
    action="DeleteUDiskSnapshot",
)
def delete_udisk_snapshot_20(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotId": variables.get("snapshot3_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().delete_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=5,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "TotalCount", 0),
        ("str_eq", "PerDiskQuota", 3),
    ],
    action="DescribeSnapshot",
)
def describe_snapshot_21(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SnapshotIds": [variables.get("snapshot3_Id")],
        "Region": variables.get("Region"),
    }

    try:
        resp = client.invoke("DescribeSnapshot", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "DescribeUDiskSnapshotResponse"),
        ("str_eq", "TotalCount", 0),
    ],
    action="DescribeUDiskSnapshot",
)
def describe_udisk_snapshot_22(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().describe_udisk_snapshot(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="DeleteUDisk",
)
def delete_udisk_23(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("udisk_noArk_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().delete_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=30,
    retry_interval=3,
    startup_delay=90,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "DataSet.0.Status", "Available"),
    ],
    action="DescribeUDisk",
)
def describe_udisk_24(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("clone_snap1_Ark"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().describe_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="DeleteUDisk",
)
def delete_udisk_25(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("clone_snap1_Ark"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().delete_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=30,
    retry_interval=3,
    startup_delay=20,
    fast_fail=True,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "DataSet.0.Status", "Available"),
    ],
    action="DescribeUDisk",
)
def describe_udisk_26(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("clone_snap1_noArk"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().describe_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=3,
    retry_interval=1,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "Action", "DeleteUDiskResponse"),
    ],
    action="DeleteUDisk",
)
def delete_udisk_27(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "UDiskId": variables.get("clone_snap1_noArk"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.udisk().delete_udisk(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp
