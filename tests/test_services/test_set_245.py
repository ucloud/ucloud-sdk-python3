""" Code is generated by ucloud-model, DO NOT EDIT IT. """

import pytest
import logging

from ucloud.core import exc
from ucloud.testing import env, funcs, op, utest

logger = logging.getLogger(__name__)


scenario = utest.Scenario(255)


@pytest.mark.skipif(env.is_ut(), reason=env.get_skip_reason())
def test_set_245(client: utest.Client, variables: dict):
    scenario.initial(variables)

    scenario.variables["Region"] = "cn-bj2"
    scenario.variables["Zone"] = "cn-bj2-02"

    scenario.run(client)


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="CreateUMemSpace",
)
def create_umem_space_00(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "Type": "double",
        "Size": 16,
        "Region": variables.get("Region"),
        "Quantity": 1,
        "Protocol": "redis",
        "Name": "Redis_fbs",
        "ChargeType": "Month",
    }

    try:
        resp = client.umem().create_umem_space(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["Space_Id"] = utest.value_at_path(resp, "SpaceId")
    return resp


@scenario.step(
    max_retries=20,
    retry_interval=10,
    startup_delay=50,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="DescribeUMem",
)
def describe_umem_01(client: utest.Client, variables: dict):
    d = {
        "ResourceId": variables.get("Space_Id"),
        "Region": variables.get("Region"),
        "Protocol": "redis",
    }

    try:
        resp = client.invoke("DescribeUMem", d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["CreateTime"] = utest.value_at_path(resp, "DataSet.0.CreateTime")
    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="DescribeUMemPrice",
)
def describe_umem_price_02(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "Type": "double",
        "Size": 16,
        "Region": variables.get("Region"),
        "Quantity": 1,
        "ChargeType": "Month",
    }

    try:
        resp = client.umem().describe_umem_price(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["GetPrice"] = utest.value_at_path(resp, "DataSet.0.Price")
    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=60,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("le", "OrderInfos.0.Amount", variables.get("GetPrice") / 100 + 0.6),
        ("gt", "OrderInfos.0.Amount", variables.get("GetPrice") / 100 - 0.6),
    ],
    action="DescribeOrderDetailInfo",
)
def describe_order_detail_info_03(client: utest.Client, variables: dict):
    d = {
        "ResourceIds": [variables.get("Space_Id")],
        "QueryAll": True,
        "OrderTypes": ["OT_BUY"],
        "OrderStates": ["OS_FINISHED"],
        "EndTime": funcs.get_timestamp(10),
        "ChargeTypes": ["Month"],
        "BeginTime": funcs.get_timestamp(10) - 1200,
    }

    try:
        resp = client.invoke("DescribeOrderDetailInfo", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=0,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="DescribeUMemUpgradePrice",
)
def describe_umem_upgrade_price_04(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "Type": "double",
        "SpaceId": variables.get("Space_Id"),
        "Size": 18,
        "Region": variables.get("Region"),
    }

    try:
        resp = client.umem().describe_umem_upgrade_price(d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["UpgradePrice"] = utest.value_at_path(resp, "Price")
    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=5,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="ResizeUMemSpace",
)
def resize_umem_space_05(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SpaceId": variables.get("Space_Id"),
        "Size": 18,
        "Region": variables.get("Region"),
    }

    try:
        resp = client.umem().resize_umem_space(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=60,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        (
            "lt",
            "OrderInfos.0.Amount",
            variables.get("UpgradePrice") / 100 + 0.1,
        ),
        (
            "gt",
            "OrderInfos.0.Amount",
            variables.get("UpgradePrice") / 100 - 0.1,
        ),
    ],
    action="DescribeOrderDetailInfo",
)
def describe_order_detail_info_06(client: utest.Client, variables: dict):
    d = {
        "ResourceIds": [variables.get("Space_Id")],
        "QueryAll": True,
        "OrderTypes": ["OT_UPGRADE"],
        "OrderStates": ["OS_FINISHED"],
        "EndTime": funcs.get_timestamp(10),
        "ChargeTypes": ["Month"],
        "BeginTime": funcs.get_timestamp(10) - 1200,
    }

    try:
        resp = client.invoke("DescribeOrderDetailInfo", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=2,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="GetResourceRenewPrice",
)
def get_resource_renew_price_07(client: utest.Client, variables: dict):
    d = {
        "ResourceIds": [variables.get("Space_Id")],
        "Quantity": 1,
        "ChargeType": "Month",
    }

    try:
        resp = client.invoke("GetResourceRenewPrice", d)
    except exc.RetCodeException as e:
        resp = e.json()

    variables["ReNewPrice"] = utest.value_at_path(resp, "RenewPriceSet.0.Price")
    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=2,
    fast_fail=False,
    validators=lambda variables: [("str_eq", "RetCode", 0)],
    action="CreateRenew",
)
def create_renew_08(client: utest.Client, variables: dict):
    d = {
        "ResourceId": variables.get("Space_Id"),
        "Quantity": 1,
        "ChargeType": "Month",
    }

    try:
        resp = client.invoke("CreateRenew", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=60,
    fast_fail=False,
    validators=lambda variables: [
        ("str_eq", "RetCode", 0),
        ("str_eq", "OrderInfos.0.Amount", "ReNewPrice"),
    ],
    action="DescribeOrderDetailInfo",
)
def describe_order_detail_info_09(client: utest.Client, variables: dict):
    d = {
        "ResourceIds": [variables.get("Space_Id")],
        "QueryAll": True,
        "OrderTypes": ["OT_RENEW"],
        "OrderStates": ["OS_FINISHED"],
        "EndTime": funcs.get_timestamp(10),
        "ChargeTypes": ["Month"],
        "BeginTime": funcs.get_timestamp(10) - 1200,
    }

    try:
        resp = client.invoke("DescribeOrderDetailInfo", d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp


@scenario.step(
    max_retries=0,
    retry_interval=0,
    startup_delay=2,
    fast_fail=False,
    action="DeleteUMemSpace",
)
def delete_umem_space_10(client: utest.Client, variables: dict):
    d = {
        "Zone": variables.get("Zone"),
        "SpaceId": variables.get("Space_Id"),
        "Region": variables.get("Region"),
    }

    try:
        resp = client.umem().delete_umem_space(d)
    except exc.RetCodeException as e:
        resp = e.json()

    return resp
